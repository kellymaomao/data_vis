// define sales_data

var data = {};

data['2011-1'] = [
  {county: "Santa Clara County", value: 518900},
  {county: "Alameda County", value: 360600},
  {county: "San Mateo County", value: 620700}
]
data['2011-2'] = [
  {county: "Santa Clara County", value: 498200},
  {county: "Alameda County", value: 358800},
  {county: "San Mateo County", value: 591900}
]
data['2011-3'] = [
  {county: "Santa Clara County", value: 484900},
  {county: "Alameda County", value: 354600},
  {county: "San Mateo County", value: 587700}
]
data['2011-4'] = [
  {county: "Santa Clara County", value: 477800},
  {county: "Alameda County", value: 352000},
  {county: "San Mateo County", value: 577500}
]
data['2011-5'] = [
  {county: "Santa Clara County", value: 487500},
  {county: "Alameda County", value: 342100},
  {county: "San Mateo County", value: 598700}
]
data['2011-6'] = [
  {county: "Santa Clara County", value: 500600},
  {county: "Alameda County", value: 336500},
  {county: "San Mateo County", value: 618400}
]
data['2011-7'] = [
  {county: "Santa Clara County", value: 504600},
  {county: "Alameda County", value: 339700},
  {county: "San Mateo County", value: 632800}
]
data['2011-8'] = [
  {county: "Santa Clara County", value: 515000},
  {county: "Alameda County", value: 339200},
  {county: "San Mateo County", value: 630300}
]
data['2011-9'] = [
  {county: "Santa Clara County", value: 512700},
  {county: "Alameda County", value: 345500},
  {county: "San Mateo County", value: 620200}
]
data['2011-10'] = [
  {county: "Santa Clara County", value: 505900},
  {county: "Alameda County", value: 343800},
  {county: "San Mateo County", value: 603700}
]
data['2011-11'] = [
  {county: "Santa Clara County", value: 496800},
  {county: "Alameda County", value: 345400},
  {county: "San Mateo County", value: 594300}
]
data['2011-12'] = [
  {county: "Santa Clara County", value: 492200},
  {county: "Alameda County", value: 342100},
  {county: "San Mateo County", value: 574000}
]
data['2012-1'] = [
  {county: "Santa Clara County", value: 496500},
  {county: "Alameda County", value: 341200},
  {county: "San Mateo County", value: 582500}
]
data['2012-2'] = [
  {county: "Santa Clara County", value: 486900},
  {county: "Alameda County", value: 343200},
  {county: "San Mateo County", value: 569600}
]
data['2012-3'] = [
  {county: "Santa Clara County", value: 485600},
  {county: "Alameda County", value: 336100},
  {county: "San Mateo County", value: 582800}
]
data['2012-4'] = [
  {county: "Santa Clara County", value: 493300},
  {county: "Alameda County", value: 337000},
  {county: "San Mateo County", value: 577900}
]
data['2012-5'] = [
  {county: "Santa Clara County", value: 514100},
  {county: "Alameda County", value: 333800},
  {county: "San Mateo County", value: 582600}
]
data['2012-6'] = [
  {county: "Santa Clara County", value: 537800},
  {county: "Alameda County", value: 350000},
  {county: "San Mateo County", value: 596800}
]
data['2012-7'] = [
  {county: "Santa Clara County", value: 561400},
  {county: "Alameda County", value: 367400},
  {county: "San Mateo County", value: 624400}
]
data['2012-8'] = [
  {county: "Santa Clara County", value: 586100},
  {county: "Alameda County", value: 385000},
  {county: "San Mateo County", value: 650300}
]
data['2012-9'] = [
  {county: "Santa Clara County", value: 595100},
  {county: "Alameda County", value: 396900},
  {county: "San Mateo County", value: 658600}
]
data['2012-10'] = [
  {county: "Santa Clara County", value: 601700},
  {county: "Alameda County", value: 402500},
  {county: "San Mateo County", value: 662600}
]
data['2012-11'] = [
  {county: "Santa Clara County", value: 600500},
  {county: "Alameda County", value: 409900},
  {county: "San Mateo County", value: 674700}
]
data['2012-12'] = [
  {county: "Santa Clara County", value: 609900},
  {county: "Alameda County", value: 416700},
  {county: "San Mateo County", value: 688400}
]
data['2013-1'] = [
  {county: "Santa Clara County", value: 625000},
  {county: "Alameda County", value: 427500},
  {county: "San Mateo County", value: 699400}
]
data['2013-2'] = [
  {county: "Santa Clara County", value: 630400},
  {county: "Alameda County", value: 433100},
  {county: "San Mateo County", value: 712400}
]
data['2013-3'] = [
  {county: "Santa Clara County", value: 632600},
  {county: "Alameda County", value: 440900},
  {county: "San Mateo County", value: 731700}
]
data['2013-4'] = [
  {county: "Santa Clara County", value: 632900},
  {county: "Alameda County", value: 447200},
  {county: "San Mateo County", value: 737500}
]
data['2013-5'] = [
  {county: "Santa Clara County", value: 644700},
  {county: "Alameda County", value: 458800},
  {county: "San Mateo County", value: 741700}
]
data['2013-6'] = [
  {county: "Santa Clara County", value: 652800},
  {county: "Alameda County", value: 472000},
  {county: "San Mateo County", value: 731000}
]
data['2013-7'] = [
  {county: "Santa Clara County", value: 656900},
  {county: "Alameda County", value: 487700},
  {county: "San Mateo County", value: 735300}
]
data['2013-8'] = [
  {county: "Santa Clara County", value: 661200},
  {county: "Alameda County", value: 497100},
  {county: "San Mateo County", value: 747400}
]
data['2013-9'] = [
  {county: "Santa Clara County", value: 665200},
  {county: "Alameda County", value: 505500},
  {county: "San Mateo County", value: 750800}
]
data['2013-10'] = [
  {county: "Santa Clara County", value: 665800},
  {county: "Alameda County", value: 511100},
  {county: "San Mateo County", value: 767700}
]
data['2013-11'] = [
  {county: "Santa Clara County", value: 666300},
  {county: "Alameda County", value: 514900},
  {county: "San Mateo County", value: 758300}
]
data['2013-12'] = [
  {county: "Santa Clara County", value: 670200},
  {county: "Alameda County", value: 516300},
  {county: "San Mateo County", value: 775000}
]
data['2014-1'] = [
  {county: "Santa Clara County", value: 686800},
  {county: "Alameda County", value: 517800},
  {county: "San Mateo County", value: 804600}
]
data['2014-2'] = [
  {county: "Santa Clara County", value: 696200},
  {county: "Alameda County", value: 526500},
  {county: "San Mateo County", value: 818800}
]
data['2014-3'] = [
  {county: "Santa Clara County", value: 706200},
  {county: "Alameda County", value: 530900},
  {county: "San Mateo County", value: 823700}
]
data['2014-4'] = [
  {county: "Santa Clara County", value: 708200},
  {county: "Alameda County", value: 535900},
  {county: "San Mateo County", value: 792500}
]
data['2014-5'] = [
  {county: "Santa Clara County", value: 711400},
  {county: "Alameda County", value: 537600},
  {county: "San Mateo County", value: 798600}
]
data['2014-6'] = [
  {county: "Santa Clara County", value: 714900},
  {county: "Alameda County", value: 543500},
  {county: "San Mateo County", value: 802300}
]
data['2014-7'] = [
  {county: "Santa Clara County", value: 709700},
  {county: "Alameda County", value: 549300},
  {county: "San Mateo County", value: 812700}
]
data['2014-8'] = [
  {county: "Santa Clara County", value: 720200},
  {county: "Alameda County", value: 562800},
  {county: "San Mateo County", value: 818500}
]
data['2014-9'] = [
  {county: "Santa Clara County", value: 724700},
  {county: "Alameda County", value: 564000},
  {county: "San Mateo County", value: 835300}
]
data['2014-10'] = [
  {county: "Santa Clara County", value: 735100},
  {county: "Alameda County", value: 561700},
  {county: "San Mateo County", value: 856500}
]
data['2014-11'] = [
  {county: "Santa Clara County", value: 738800},
  {county: "Alameda County", value: 558900},
  {county: "San Mateo County", value: 884700}
]
data['2014-12'] = [
  {county: "Santa Clara County", value: 747700},
  {county: "Alameda County", value: 562000},
  {county: "San Mateo County", value: 891500}
]
data['2015-1'] = [
  {county: "Santa Clara County", value: 752600},
  {county: "Alameda County", value: 566500},
  {county: "San Mateo County", value: 894800}
]
data['2015-2'] = [
  {county: "Santa Clara County", value: 760200},
  {county: "Alameda County", value: 569400},
  {county: "San Mateo County", value: 893100}
]
data['2015-3'] = [
  {county: "Santa Clara County", value: 763800},
  {county: "Alameda County", value: 584500},
  {county: "San Mateo County", value: 914200}
]
data['2015-4'] = [
  {county: "Santa Clara County", value: 770200},
  {county: "Alameda County", value: 604600},
  {county: "San Mateo County", value: 932100}
]
data['2015-5'] = [
  {county: "Santa Clara County", value: 779600},
  {county: "Alameda County", value: 611500},
  {county: "San Mateo County", value: 953600}
]
data['2015-6'] = [
  {county: "Santa Clara County", value: 791600},
  {county: "Alameda County", value: 610700},
  {county: "San Mateo County", value: 950400}
]
data['2015-7'] = [
  {county: "Santa Clara County", value: 806400},
  {county: "Alameda County", value: 607900},
  {county: "San Mateo County", value: 956100}
]
data['2015-8'] = [
  {county: "Santa Clara County", value: 824300},
  {county: "Alameda County", value: 614000},
  {county: "San Mateo County", value: 959600}
]
data['2015-9'] = [
  {county: "Santa Clara County", value: 826900},
  {county: "Alameda County", value: 619400},
  {county: "San Mateo County", value: 971000}
]
data['2015-10'] = [
  {county: "Santa Clara County", value: 827700},
  {county: "Alameda County", value: 624300},
  {county: "San Mateo County", value: 960800}
]
data['2015-11'] = [
  {county: "Santa Clara County", value: 823200},
  {county: "Alameda County", value: 623300},
  {county: "San Mateo County", value: 962500}
]
data['2015-12'] = [
  {county: "Santa Clara County", value: 836600},
  {county: "Alameda County", value: 634400},
  {county: "San Mateo County", value: 959200}
]
data['2016-1'] = [
  {county: "Santa Clara County", value: 840500},
  {county: "Alameda County", value: 639400},
  {county: "San Mateo County", value: 989500}
]
data['2016-2'] = [
  {county: "Santa Clara County", value: 843000},
  {county: "Alameda County", value: 663500},
  {county: "San Mateo County", value: 983300}
]
data['2016-3'] = [
  {county: "Santa Clara County", value: 840400},
  {county: "Alameda County", value: 657600},
  {county: "San Mateo County", value: 973500}
]
data['2016-4'] = [
  {county: "Santa Clara County", value: 847800},
  {county: "Alameda County", value: 658700},
  {county: "San Mateo County", value: 976800}
]
data['2016-5'] = [
  {county: "Santa Clara County", value: 851200},
  {county: "Alameda County", value: 648200},
  {county: "San Mateo County", value: 989400}
]
data['2016-6'] = [
  {county: "Santa Clara County", value: 853000},
  {county: "Alameda County", value: 651500},
  {county: "San Mateo County", value: 1043900}
]
data['2016-7'] = [
  {county: "Santa Clara County", value: 857500},
  {county: "Alameda County", value: 650300},
  {county: "San Mateo County", value: 1052600}
]
data['2016-8'] = [
  {county: "Santa Clara County", value: 857600},
  {county: "Alameda County", value: 648400},
  {county: "San Mateo County", value: 1057800}
]
data['2016-9'] = [
  {county: "Santa Clara County", value: 862000},
  {county: "Alameda County", value: 654200},
  {county: "San Mateo County", value: 1036700}
]
data['2016-10'] = [
  {county: "Santa Clara County", value: 866400},
  {county: "Alameda County", value: 659400},
  {county: "San Mateo County", value: 1021200}
]
data['2016-11'] = [
  {county: "Santa Clara County", value: 872500},
  {county: "Alameda County", value: 674600},
  {county: "San Mateo County", value: 1019000}
]
data['2016-12'] = [
  {county: "Santa Clara County", value: 871900},
  {county: "Alameda County", value: 678300},
  {county: "San Mateo County", value: 1002200}
]
data['2017-1'] = [
  {county: "Santa Clara County", value: 873700},
  {county: "Alameda County", value: 687900},
  {county: "San Mateo County", value: 1002000}
]
data['2017-2'] = [
  {county: "Santa Clara County", value: 881700},
  {county: "Alameda County", value: 703900},
  {county: "San Mateo County", value: 1012500}
]
data['2017-3'] = [
  {county: "Santa Clara County", value: 896300},
  {county: "Alameda County", value: 717800},
  {county: "San Mateo County", value: 1012300}
]
data['2017-4'] = [
  {county: "Santa Clara County", value: 900100},
  {county: "Alameda County", value: 722700},
  {county: "San Mateo County", value: 1039700}
]
data['2017-5'] = [
  {county: "Santa Clara County", value: 904100},
  {county: "Alameda County", value: 701200},
  {county: "San Mateo County", value: 1060600}
]
data['2017-6'] = [
  {county: "Santa Clara County", value: 913100},
  {county: "Alameda County", value: 698300},
  {county: "San Mateo County", value: 1100500}
]
data['2017-7'] = [
  {county: "Santa Clara County", value: 922200},
  {county: "Alameda County", value: 700600},
  {county: "San Mateo County", value: 1104900}
]
data['2017-8'] = [
  {county: "Santa Clara County", value: 937800},
  {county: "Alameda County", value: 709400},
  {county: "San Mateo County", value: 1102300}
]
data['2017-9'] = [
  {county: "Santa Clara County", value: 958800},
  {county: "Alameda County", value: 716700},
  {county: "San Mateo County", value: 1108200}
]
data['2017-10'] = [
  {county: "Santa Clara County", value: 991200},
  {county: "Alameda County", value: 729900},
  {county: "San Mateo County", value: 1128300}
]
data['2017-11'] = [
  {county: "Santa Clara County", value: 1014400},
  {county: "Alameda County", value: 742900},
  {county: "San Mateo County", value: 1201700}
]
data['2017-12'] = [
  {county: "Santa Clara County", value: 1065500},
  {county: "Alameda County", value: 755800},
  {county: "San Mateo County", value: 1243100}
]
data['2018-1'] = [
  {county: "Santa Clara County", value: 1109200},
  {county: "Alameda County", value: 769900},
  {county: "San Mateo County", value: 1289500}
]
data['2018-2'] = [
  {county: "Santa Clara County", value: 1153100},
  {county: "Alameda County", value: 794200},
  {county: "San Mateo County", value: 1278300}
]
data['2018-3'] = [
  {county: "Santa Clara County", value: 1179700},
  {county: "Alameda County", value: 798700},
  {county: "San Mateo County", value: 1275200}
]
data['2018-4'] = [
  {county: "Santa Clara County", value: 1174900},
  {county: "Alameda County", value: 801800},
  {county: "San Mateo County", value: 1252100}
]
data['2018-5'] = [
  {county: "Santa Clara County", value: 1176700},
  {county: "Alameda County", value: 796900},
  {county: "San Mateo County", value: 1240100}
]
data['2018-6'] = [
  {county: "Santa Clara County", value: 1146000},
  {county: "Alameda County", value: 804500},
  {county: "San Mateo County", value: 1251600}
]
data['2018-7'] = [
  {county: "Santa Clara County", value: 1135500},
  {county: "Alameda County", value: 804000},
  {county: "San Mateo County", value: 1256200}
]
data['2018-8'] = [
  {county: "Santa Clara County", value: 1137100},
  {county: "Alameda County", value: 800400},
  {county: "San Mateo County", value: 1265900}
]
data['2018-9'] = [
  {county: "Santa Clara County", value: 1124400},
  {county: "Alameda County", value: 802100},
  {county: "San Mateo County", value: 1282100}
]
data['2018-10'] = [
  {county: "Santa Clara County", value: 1143100},
  {county: "Alameda County", value: 798700},
  {county: "San Mateo County", value: 1285100}
]
data['2018-11'] = [
  {county: "Santa Clara County", value: 1112300},
  {county: "Alameda County", value: 799600},
  {county: "San Mateo County", value: 1278500}
]
data['2018-12'] = [
  {county: "Santa Clara County", value: 1101200},
  {county: "Alameda County", value: 794400},
  {county: "San Mateo County", value: 1254100}
]


const santa_clara_annotations = [
  {
    note: {
      label: "1. In 2017, Median Household Income in Santa Clara County \
      is $119,035.",
      wrap: 500,
    },
    x: 300,
    y: 50,
  },
  {
    note: {
      label: "2. The Major Employers in Santa Clara County include Adobe, \
      Apple, Alphabet (Google), and Intel.",
      wrap: 500,
    },
    x: 320,
    y: 110,
  }
].map(function(d){ d.color = "#E8336D";  return d})

const alameda_annotations = [
  {
    note: {
      label: "1. In 2017, Median Household Income in Alameda County is $96,296.",
      wrap: 500,
    },
    x: 300,
    y: 50,
  },
  {
    note: {
      label: "2. The four largest companies in Alameda County are Telecare, \
      Wind River, Penumbra, and The North Face, Inc.",
      wrap: 500,
    },
    x: 332,
    y: 110,
  }
].map(function(d){ d.color = "#E8336D";  return d})

const san_mateo_annotations = [
  {
    note: {
      label: "1. In 2017, Median Household Income in San Mateo County is $116,653.",
      wrap: 500,
    },
    x: 300,
    y: 50,
  },
  {
    note: {
      label: "2. The Major Employers in San Mateo County are Electronic \
      Arts Inc, Facebook, Fisher Investments, Oracle and Visa. Facebook \
      went public with its initial public offering (IPO) in May 2012.",
      wrap: 500,
    },
    x: 320,
    y: 110,
  }
].map(function(d){ d.color = "#E8336D";  return d})


function line_plot_by_county(county_name) {
  var colors = d3.scaleQuantize().domain([0,2]).range(['purple', 'red', 'green']);

  var cur_data = [];
  Object.keys(data).forEach(function(year_month) {
    if (county_name === "Santa Clara County") {
      cur_data.push({"date":year_month, "SalePrice":data[year_month][0].value});
    }
    else if (county_name === "Alameda County") {
      cur_data.push({"date":year_month, "SalePrice":data[year_month][1].value});
    }
    else if (county_name === "San Mateo County") {
      cur_data.push({"date":year_month, "SalePrice":data[year_month][2].value});
    }
    else {
      throw "Not a valid county name";
    }
  });

  var margin = 80;
  var width = 1000;
  var height = 500;

  var parseTime = d3.timeParse("%Y-%m");

  cur_data.forEach(function(element) {
      element.date = parseTime(element.date);
      element.SalePrice = parseInt(element.SalePrice);
  });
  var formatTime = d3.timeFormat("%Y-%m");

  var xScale = d3.scaleTime()
    .domain(d3.extent(cur_data, function(d) {
      return d.date;
    }))
    .range([0, width]);

  var yScale = d3.scaleLinear()
    .domain([0, 1500000])
    .range([height, 0]);


  d3.select('#line-graph-container').select("svg").remove();

  var svg = d3.select('#line-graph-container')
    .append('svg')
    .attr('width', width + 2*margin)
    .attr('height', height + 2*margin);

  var g = svg.append("g")
    .attr("transform","translate(" + margin + "," + margin + ")")

  var addline = d3.line()
    .x(function(d) {return xScale(d.date);})
    .y(function(d) {return yScale(d.SalePrice);});

  const div = d3
    .select('body')
    .append('div')
    .attr('class', 'tooltip');

  g.append("path")
    .datum(cur_data)
    .attr("class", "line")
    .attr("stroke", function() {
      if (county_name === "Santa Clara County") {
        return colors(0);
      }
      else if (county_name === "Alameda County") {
        return colors(1);
      }
      else if (county_name === "San Mateo County") {
        return colors(2);
      }
      else {
        throw "Not a valid county name";
      }
    })
    .attr("d", addline);

  g.selectAll('dot')
    .data(cur_data)
    .enter()
    .append('circle')
    .attr('r', 3)
    .attr('cx', d => xScale(d.date))
    .attr('cy', d => yScale(d.SalePrice))
    .attr("fill", function() {
      if (county_name === "Santa Clara County") {
        return colors(0);
      }
      else if (county_name === "Alameda County") {
        return colors(1);
      }
      else if (county_name === "San Mateo County") {
        return colors(2);
      }
      else {
        throw "Not a valid county name";
      }
    })
    .on("mouseover", function(d) {
    div.style("opacity", 1)
      .style("left",(d3.event.pageX -10)+"px")
      .style("top",(d3.event.pageY +10)+"px")
      .html(formatTime(d.date) + "<br/>$ " + d.SalePrice);
    })
    .on("mouseout", function(d) {div.style("opacity", 0)});

  var xAxisTrans = d3.axisBottom(xScale)
    .ticks(cur_data.length)
    .tickFormat(d3.timeFormat("%Y-%m"))
    .tickValues(cur_data.map(d=>d.date));

  d3.select("svg").append("g")
    .attr("transform", "translate(" + margin + "," +(height+margin)+ ")")
    .call(xAxisTrans);

  var ticks = d3.selectAll(".tick text");

  ticks.attr("class", function(d,i){
   if(i%5 != 0) d3.select(this).remove();
  });

  d3.select("svg").append("g")
    .attr("transform", "translate(" + margin + "," + margin + ")")
    .call(d3.axisLeft(yScale));

  //add titles to the axes
  svg.append("text")
    .attr("text-anchor", "middle")
    .attr("transform", "translate("+ (margin-60) +","+(margin+220)+")rotate(-90)")
    .text("Median House Sale Price ($)");

  svg.append("text")
    .attr("text-anchor", "middle")
    .attr("transform", "translate("+ (width/2+20) +","+(height+margin+35)+")")
    .text("Date");

    var annotations = []
    if (county_name === "Santa Clara County") {
      annotations = santa_clara_annotations;
    }
    else if (county_name === "Alameda County") {
      annotations = alameda_annotations;
    }
    else if (county_name === "San Mateo County") {
      annotations = san_mateo_annotations;
    }
    else {
      throw "Not a valid county name";
    }

    const makeAnnotations = d3.annotation()
      .type(d3.annotationLabel)
      .annotations(annotations)

    d3.select("svg")
      .append("g")
      .attr("class", "annotation-group")
      .attr('font-size', 30)
      .call(makeAnnotations)
}
